<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Codecade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'VT323', monospace; background: #000 url('/assets/images/background.jpg') center center / cover no-repeat fixed; }
        .text-glow-blue { color: #4fc3f7; text-shadow: 0 0 3px #4fc3f7, 0 0 6px #4fc3f7; }
        .text-glow-purple { color: #9c27b0; text-shadow: 0 0 3px #9c27b0, 0 0 6px #9c27b0; }
        .text-glow-cyan { color: #00bcd4; text-shadow: 0 0 3px #00bcd4, 0 0 6px #00bcd4; }
        .retro-panel { background: linear-gradient(135deg, rgba(63, 81, 181, 0.9), rgba(156, 39, 176, 0.7)); border: 2px solid #3f51b5; box-shadow: 0 0 8px rgba(63, 81, 181, 0.5); }
        .stat-card { background: rgba(26, 35, 126, 0.8); border: 2px solid #3f51b5; transition: all 0.3s ease; }
        .stat-card:hover { border-color: #4fc3f7; box-shadow: 0 0 15px rgba(79, 195, 247, 0.3); }
        .profile-avatar { width: 80px; height: 80px; border: 3px solid #3f51b5; border-radius: 50%; background: #1a237e; box-shadow: 0 0 15px rgba(63, 81, 181, 0.5); }
        .badge { background: rgba(79, 195, 247, 0.2); border: 1px solid #4fc3f7; }
        .section-toggle { cursor: pointer; transition: all 0.2s ease; }
        .section-toggle:hover { color: #ff1493; }
        .skeleton { background: linear-gradient(90deg, #444 25%, #555 50%, #444 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .mobile-card-carousel { scroll-snap-type: x mandatory; }
        .mobile-card-carousel > * { scroll-snap-align: start; }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="bg-purple-900/40 min-h-screen">
        <!-- Header -->
        <header class="bg-black/50 border-b-2 border-blue-500 p-4">
            <div class="flex items-center justify-between max-w-7xl mx-auto px-4">
                <a href="index.html" class="text-xl text-blue-400 hover:text-blue-300">‚Üê Back to Home</a>
                <h1 class="text-2xl font-bold text-glow-blue">Player Profile</h1>
            </div>
        </header>

        <div class="max-w-6xl mx-auto px-4 py-6">
            <!-- Row 1: Profile Hero (Compact) -->
            <div class="retro-panel rounded-xl p-6 mb-6">
                <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
                    <div class="flex items-center gap-4">
                        <div class="profile-avatar flex items-center justify-center text-3xl text-glow-blue" id="profileAvatar">?</div>
                        <div>
                            <h2 class="text-2xl font-bold text-glow-blue" id="profileName">CodeMaster</h2>
                            <p class="text-gray-300 text-sm" id="profileHeadline">Full Stack Developer ‚Äî MIT</p>
                        </div>
                    </div>
                    
                    <div class="flex-1 grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-xl font-bold text-glow-cyan" id="userXP">15,420</div>
                            <div class="text-xs text-gray-400">XP</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold text-glow-cyan" id="userLevel">42</div>
                            <div class="text-xs text-gray-400">Level</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold text-glow-cyan" id="userStreak">12</div>
                            <div class="text-xs text-gray-400">Streak</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="followBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm font-bold transition-colors" aria-label="Follow user">
                            Follow
                        </button>
                        <button id="editBtn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm font-bold transition-colors hidden" aria-label="Edit profile">
                            ‚úèÔ∏è Edit
                        </button>
                    </div>
                </div>
            </div>

            <!-- Row 2: Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- College Card -->
                <div class="stat-card rounded-xl p-6">
                    <h3 class="text-lg text-glow-purple mb-4">College</h3>
                    <div class="text-2xl font-bold text-glow-cyan" id="collegeCard">MIT</div>
                    <div class="text-sm text-gray-400 mt-2">Computer Science</div>
                </div>

                <!-- XP Progress Card -->
                <div class="stat-card rounded-xl p-6">
                    <h3 class="text-lg text-glow-purple mb-4">Experience</h3>
                    <div class="text-2xl font-bold text-glow-cyan mb-2" id="xpCard">15,420 XP</div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mb-2">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" style="width: 68%"></div>
                    </div>
                    <div class="text-xs text-gray-400">Level 42 ‚Üí 43 (4,580 XP to go)</div>
                </div>

                <!-- Streak Card -->
                <div class="stat-card rounded-xl p-6">
                    <h3 class="text-lg text-glow-purple mb-4">Current Streak</h3>
                    <div class="text-2xl font-bold text-glow-cyan mb-2" id="streakCard">12 Days</div>
                    <div class="text-sm text-gray-400">Best: 28 days</div>
                    <div class="text-xs text-gray-400 mt-1">üî• Keep it going!</div>
                </div>
            </div>

            <!-- Micro Stats Row -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="stat-card rounded-lg p-4 text-center">
                    <div class="text-lg font-bold text-glow-blue" id="problemsSolved">247</div>
                    <div class="text-xs text-gray-400">Problems Solved</div>
                </div>
                <div class="stat-card rounded-lg p-4 text-center">
                    <div class="text-lg font-bold text-glow-blue" id="successRate">78%</div>
                    <div class="text-xs text-gray-400">Success Rate</div>
                </div>
                <div class="stat-card rounded-lg p-4 text-center">
                    <div class="text-lg font-bold text-glow-blue" id="avgTime">23m</div>
                    <div class="text-xs text-gray-400">Avg Time</div>
                </div>
                <div class="stat-card rounded-lg p-4 text-center">
                    <div class="text-lg font-bold text-glow-blue" id="globalRank">#1,247</div>
                    <div class="text-xs text-gray-400">Global Rank</div>
                </div>
            </div>

            <!-- Collapsible Sections -->
            <div class="space-y-4">
                <!-- Progress & Stats Section -->
                <div class="retro-panel rounded-xl">
                    <div class="section-toggle p-4 border-b border-blue-600" onclick="toggleSection('progress')">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl text-glow-purple">üìä Progress & Stats</h3>
                            <span class="text-gray-400" id="progressToggle">‚ñº</span>
                        </div>
                    </div>
                    <div id="progressSection" class="p-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg text-glow-blue mb-3">Problems by Difficulty</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-green-400">Easy</span>
                                        <span>120/150</span>
                                        <div class="w-20 bg-gray-700 rounded-full h-2">
                                            <div class="bg-green-400 h-2 rounded-full" style="width: 80%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-yellow-400">Medium</span>
                                        <span>95/200</span>
                                        <div class="w-20 bg-gray-700 rounded-full h-2">
                                            <div class="bg-yellow-400 h-2 rounded-full" style="width: 47%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-red-400">Hard</span>
                                        <span>32/100</span>
                                        <div class="w-20 bg-gray-700 rounded-full h-2">
                                            <div class="bg-red-400 h-2 rounded-full" style="width: 32%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg text-glow-blue mb-3">Recent Activity</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Two Sum</span>
                                        <span class="text-green-400">‚úì Solved</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Valid Parentheses</span>
                                        <span class="text-green-400">‚úì Solved</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Merge Intervals</span>
                                        <span class="text-red-400">‚úó Failed</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Submissions Section -->
                <div class="retro-panel rounded-xl">
                    <div class="section-toggle p-4 border-b border-blue-600" onclick="toggleSection('submissions')">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl text-glow-purple">üìù Recent Submissions</h3>
                            <span class="text-gray-400" id="submissionsToggle">‚ñº</span>
                        </div>
                    </div>
                    <div id="submissionsSection" class="p-4">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-blue-600">
                                        <th class="text-left p-2 text-glow-blue">Problem</th>
                                        <th class="text-left p-2 text-glow-blue">Status</th>
                                        <th class="text-left p-2 text-glow-blue">Time</th>
                                        <th class="text-left p-2 text-glow-blue">Date</th>
                                        <th class="text-left p-2 text-glow-blue">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="submissionsTable">
                                    <tr class="border-b border-gray-700">
                                        <td class="p-2">Two Sum</td>
                                        <td class="p-2 text-green-400">Accepted</td>
                                        <td class="p-2">15m 23s</td>
                                        <td class="p-2">2 hours ago</td>
                                        <td class="p-2">
                                            <button class="text-cyan-400 hover:text-cyan-300 text-xs">View Code</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div class="retro-panel rounded-xl">
                    <div class="section-toggle p-4 border-b border-blue-600" onclick="toggleSection('achievements')">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl text-glow-purple">üèÜ Achievements & Badges</h3>
                            <span class="text-gray-400" id="achievementsToggle">‚ñº</span>
                        </div>
                    </div>
                    <div id="achievementsSection" class="p-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="badge rounded-lg p-3 text-center" title="Solved 100 problems">
                                <div class="text-2xl mb-1">üéØ</div>
                                <div class="text-xs">Century</div>
                            </div>
                            <div class="badge rounded-lg p-3 text-center" title="7-day streak">
                                <div class="text-2xl mb-1">üî•</div>
                                <div class="text-xs">Hot Streak</div>
                            </div>
                            <div class="badge rounded-lg p-3 text-center" title="Solved first hard problem">
                                <div class="text-2xl mb-1">üí™</div>
                                <div class="text-xs">Hard Mode</div>
                            </div>
                            <div class="badge rounded-lg p-3 text-center" title="Speed demon">
                                <div class="text-2xl mb-1">‚ö°</div>
                                <div class="text-xs">Lightning</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="retro-panel rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl text-glow-blue mb-4">Edit Profile</h3>
            <form id="editForm">
                <div class="mb-4">
                    <label class="block text-sm text-gray-300 mb-2">Name</label>
                    <input type="text" id="editName" class="w-full p-2 bg-gray-800 border border-blue-500 rounded text-white">
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-gray-300 mb-2">Headline</label>
                    <input type="text" id="editHeadline" class="w-full p-2 bg-gray-800 border border-blue-500 rounded text-white">
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-gray-300 mb-2">University</label>
                    <input type="text" id="editUniversity" class="w-full p-2 bg-gray-800 border border-blue-500 rounded text-white">
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white font-bold">Save</button>
                    <button type="button" onclick="closeEditModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white font-bold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Profile data
        const profileData = {
            name: "CodeMaster",
            headline: "New User",
            university: "Unknown",
            xp: 0,
            level: 1,
            streak: 0,
            problemsSolved: 0,
            successRate: 0,
            avgTime: "0m",
            rank: 0,
            isOwnProfile: true
        };
        
        async function loadProfileData() {
            const token = localStorage.getItem('codecade_token');
            if (!token) return;
            
            try {
                const statsRes = await fetch('http://localhost:8080/user/stats', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const stats = await statsRes.json();
                
                const progressRes = await fetch('http://localhost:8080/user/progress', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const progress = await progressRes.json();
                
                profileData.name = stats.username || 'Player';
                profileData.university = stats.college || 'Unknown';
                profileData.xp = stats.xp || 0;
                profileData.level = stats.level || 1;
                profileData.streak = stats.streak_days || 0;
                profileData.problemsSolved = progress.totalSolved || 0;
                profileData.successRate = progress.totalSolved > 0 ? 100 : 0;
                profileData.avgTime = progress.totalSolved > 0 ? '15m' : '0m';
                profileData.rank = 3;
                
                initProfile();
            } catch (error) {
                console.error('Failed to load profile:', error);
                initProfile();
            }
        }
        
        loadProfileData();

        // Initialize profile
        function initProfile() {
            document.getElementById('profileName').textContent = profileData.name;
            document.getElementById('profileHeadline').textContent = profileData.headline;
            document.getElementById('userXP').textContent = profileData.xp.toLocaleString();
            document.getElementById('userLevel').textContent = profileData.level;
            document.getElementById('userStreak').textContent = profileData.streak;
            document.getElementById('collegeCard').textContent = profileData.university;
            document.getElementById('xpCard').textContent = `${profileData.xp.toLocaleString()} XP`;
            document.getElementById('streakCard').textContent = `${profileData.streak} Days`;
            document.getElementById('problemsSolved').textContent = profileData.problemsSolved;
            document.getElementById('successRate').textContent = `${profileData.successRate}%`;
            document.getElementById('avgTime').textContent = profileData.avgTime;
            document.getElementById('globalRank').textContent = `#${profileData.rank.toLocaleString()}`;
            
            // Show edit button if own profile
            if (profileData.isOwnProfile) {
                document.getElementById('editBtn').classList.remove('hidden');
                document.getElementById('followBtn').classList.add('hidden');
            }
            
            // Set avatar initial
            document.getElementById('profileAvatar').textContent = profileData.name.charAt(0);
        }

        // Toggle sections
        function toggleSection(sectionName) {
            const section = document.getElementById(sectionName + 'Section');
            const toggle = document.getElementById(sectionName + 'Toggle');
            
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                toggle.textContent = '‚ñº';
            } else {
                section.classList.add('hidden');
                toggle.textContent = '‚ñ∂';
            }
        }

        // Edit modal functions
        function openEditModal() {
            document.getElementById('editName').value = profileData.name;
            document.getElementById('editHeadline').value = profileData.headline;
            document.getElementById('editUniversity').value = profileData.university;
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        // Event listeners
        document.getElementById('editBtn').addEventListener('click', openEditModal);
        
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Update profile data (would normally be API call)
            profileData.name = document.getElementById('editName').value;
            profileData.headline = document.getElementById('editHeadline').value;
            profileData.university = document.getElementById('editUniversity').value;
            
            // Update UI
            initProfile();
            closeEditModal();
        });

        document.getElementById('followBtn').addEventListener('click', function() {
            const btn = this;
            if (btn.textContent === 'Follow') {
                btn.textContent = 'Following ‚úì';
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                btn.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                btn.textContent = 'Follow';
                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initProfile);

        // Close modal on outside click
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditModal();
        });
    </script>
</body>
</html>